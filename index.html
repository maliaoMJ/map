<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <!--width - 可视区域的宽度，值可为数字或关键词device-width -->
    <!--height - viewport的高度-->
    <!--initial-scale - 初始的缩放比例-->
    <!--minimum-scale - 允许用户缩放到的最小比例-->
    <!--maximum-scale - 允许用户缩放到的最大比例-->
    <!--user-scalable - 用户是否可以手动缩放-->
    <meta name = "viewport" content = "width = device-width, initial-scale = 1.0, maximum-scale = 1.0, user-scalable = 0" />
    <!--content="telephone=yes" 在iPhone 手机上默认值是（电话号码显示为拨号的超链接）：-->
    <!--可将telephone=no，则手机号码不被显示为拨号链接-->
    <!--使设备浏览网页时对数字不启用电话功能（不同设备解释不同，itouch点击数字为存入联系人，iphone为拨打电话），忽略将页面中的数字识别为电话号码。-->
    <meta name="format-detection" content="telephone=no" />
    <!--忽略识别邮箱-->
    <meta name="format-detection" content="email=no" />
    <!--网站开启对 web app 程序的支持-->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!--在 web app 应用下状态条（屏幕顶部条）的颜色；(改变顶部状态条的颜色)-->
    <!--默认值为 default（白色），可以定为 black（黑色）和 black-translucent（灰色半透明）；-->
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--http-equiv="Content-Type" 表示描述文档类型-->
    <!--HTTP-EQUIV类似于HTTP的头部协议，它回应给浏览器一些有用的信息，以帮助正确和精确地显示网页内容-->
    <meta http-equiv="Content-Type" content="text/html">
    <!-- UC默认竖屏 ，UC强制全屏 -->
    <meta name="full-screen" content="yes">
    <!--使用了application这种应用模式后，页面讲默认全屏，禁止长按菜单，禁止收拾，标准排版，以及强制图片显示。-->
    <!--应用模式-->
    <meta name="browsermode" content="application">
    <!-- QQ强制竖屏 QQ强制全屏 -->
    <!--设置屏幕方向-->
    <meta name="x5-orientation" content="portrait">
    <!--设置全屏-->
    <meta name="x5-fullscreen" content="true">
    <!--设置屏幕模式-->
    <meta name="x5-page-mode" content="app">
    <!-- windows phone 点击无高光 -->
    <meta name="msapplication-tap-highlight" content="no">
    <title>公共地图</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.1.1/css/bootstrap.css">
    <style>
        *{
            padding: 0;
            margin: 0;
        }
        body{

        }
        #container{

            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .map{

            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .positionIcon{
            width: 30px;
            height:30px;
            background: rgba(0,0,0,0.7);
            border-radius: 3px;
            position: relative;
            bottom: 18px;
            left: 30px;
            z-index: 666;
            cursor: pointer;

        }
        .positionIcon>i{
            display:block;
            position: absolute;
            top: 5px;
            left: 5px;
            width: 20px;
            height: 20px;
            color: #0077ff;
            text-align: center;
            line-height: 20px;

        }
        .amap-copyright,.amap-logo{
            display: none!important;
        }
        .amap-scale-line {
            position: relative;
            bottom: -15px;
            height: 8px;
        }
        .amap-scale-text {
            text-align: center;
            font-size: 10px;
            position: relative;
            top: 10px;
        }
     /*    #panel {
        position: fixed;
        background-color: white;
        max-height: 70%;
        overflow-y: auto;
        top: 10px;
        right: 10px;
        width: 100px;
        border-bottom: solid 1px silver;
        } */
    </style>
</head>
<body>
   <div id="container" >
       <div class="map" id="map"></div>
       <!-- <div id="panel"></div> -->
   </div>
</body>
<script type="text/javascript" src="https://cdn.bootcss.com/jquery/2.0.2/jquery.js"></script>
<script type="text/javascript" src="https://cdn.bootcss.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src = 'https://webapi.amap.com/maps?v=1.4.0&key=d77ea90c97069ad0b74183b70b648653'></script>
<!-- <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.3&key=d77ea90c97069ad0b74183b70b648653"></script> -->
 <script type="text/javascript" src="https://cache.amap.com/lbs/static/addToolbar.js"></script>
<script type="text/javascript">
   //全局变量 经度lng 纬度lat
   var lng = null;
   var lat = null;
   var LocationIcon = `<div class="positionIcon"><i class="glyphicon glyphicon-map-marker"></i></div>`;
   var map = new AMap.Map('map', {
        resizeEnable: true,
        zoom:17,
        zooms:[3,19],
    });
    //地图比例尺
    map.plugin(["AMap.Scale"],function(){ 
        let scale = new AMap.Scale(); 
        map.addControl(scale); 
    });
    // map + -
    map.plugin(["AMap.ToolBar"],function(){ 
        let tool = new AMap.ToolBar();
        map.addControl(tool);
    });
    //地图定位
    map.plugin('AMap.Geolocation',function (){
        geolocation = new AMap.Geolocation({
                enableHighAccuracy: true,//是否使用高精度定位，默认:true
                timeout: 10000,          //超过10秒后停止定位，默认：无穷大
                maximumAge: 1000,           //定位结果缓存0毫秒，默认：0
                convert: true,           //自动偏移坐标，偏移后的坐标为高德坐标，默认：true
                showButton: true, //显示定位按钮，默认：true
                buttonDom:LocationIcon,//地位小图标      
                buttonPosition: 'LB',    //定位按钮停靠位置，默认：'LB'，左下角
                buttonOffset: new AMap.Pixel(10, 20),//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
                showMarker: true,        //定位成功后在定位到的位置显示点标记，默认：true
                showCircle: true,        //定位成功后用圆圈表示定位精度范围，默认：true
                panToLocation: true,     //定位成功后将定位到的位置作为地图中心点，默认：true
                zoomToAccuracy:true      //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
            });
        map.addControl(geolocation);
        geolocation.getCurrentPosition();
        AMap.event.addListener(geolocation, 'complete', locationComplete);
        AMap.event.addListener(geolocation, 'error', locationError);  
    });
    var locationComplete = function(data){
        alert('定位成功！');
        //对全局经纬度赋值
        // lng = data.position.lng;
        // lat - data.position.lat;
        // getResult()
        // console.log(data);
        alert('经度:'+data.position.lng+'纬度:'+data.position.lat);
               };
    var locationError = function(){
      alert('定位失败，请在手机上开启定位:设置->隐私->定位服务->reactNativeApp->使用应用权限');
      }; 
    //切换图层 
    map.plugin(["AMap.MapType"],function(){ 
     var type= new AMap.MapType({ defaultType:0 });
      map.addControl(type); 
    });
    //附近搜索
    function getResult(){
       AMap.service(["AMap.PlaceSearch"], function() {
        var placeSearch = new AMap.PlaceSearch({ //构造地点查询类
            pageSize: 10,
            type: '餐饮服务',
            pageIndex: 1,
            city: "010", //城市
            map: map,
            // panel: "panel"
           
        });
        
        var cpoint = [lng, lat]; //中心点坐标
        placeSearch.searchNearBy('', cpoint, 20000, function(status, result) {
           console.log(result);
        });
    });
    }
    



</script>

</html>
